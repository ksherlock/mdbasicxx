# MD-BASIC++

A pre-processor for MD-BASIC.

## Roadmap:


### Mini Assembler

Generates appropriate `DATA` or `& POKE` (AmperWorks) statements.


#### Example

input:

        #asm
                .org $300
                .export start, end
        start
                lda #0
                rts
        end
        #endasm

        #asm
                .org $300
                .poke

                lda #0
                rts

        #endasm

output:


        ' generated by mdbasic++ 0.0.1
        #define __MDBASICXX__
        #define __DATE__ "Aug  5 2017"
        #define __TIME__ "08:19:37"
        #define START 768
        #define END 771

            DATA 169,0,96
            & POKE 768,169,0,96


#### Directives

            .machine    [6502 | 65c02 | 65816]      ; specify machine (default 6502)
            .org        number                      ; set origin
            .long       [mx]                        ; '816 - assume long m or x
            .short      [mx]                        ; '816 - assume short m or x
            .poke                                   ; use & POKE
    label   .equ        number
            .export     label [, label ...]         ; export label (as #define)


##### Data Directives

            .db         expr [, expr ...]           ; 8-bit data
            .dw         expr [, expr ...]           ; 16-bit data
            .da         expr [, expr ...]           ; 24-bit data
            .dl         expr [, expr ...]           ; 32-bit data

            .dci        [on | off]                  ; string dextral character inverted
            .msb        [on | off]                  ; strings most significant bit

            .str        string [, string ...]       ; string data
            .pstr       string [, string ...]       ; pascal string data

_n.b._: `.str` and `.pstr` accept a list of string ("like this") or expressions (which will save as bytes).
The the `.msb` and `.dci` settings only apply to double-quoted strings.


#### Address Modes

`<`, `|`, and `>` are address mode selectors, not unary operators.  If no address mode is explicitly
specified, the Mini Assembler will default to absolute address mode.  If the operand size can be
determined (i.e., an integer constant or symbol value is known), it will default to zp, absolute, or
absolute long based on the operand size.


#### Expressions
##### Terminals

            {basic-expression}                      ; inserted as-is. only valid with .poke
            symbol                                  ; symbol
            %10                                     ; binary integer
            10                                      ; decimal integer
            $10                                     ; hexadecimal integer
            0x10                                    ; hexadecimal integer
            '10'                                    ; character constant

##### Unary Operators

            + - ^ ~

_n.b._: Unary ^ is right shift 16.

##### Binary Operators

            + - * / % & | ^ >> <<

_n.b._: Binary operations use same precedence as `C`. Parenthesis are not supported within expressions.







### More command-line flags

    -D macroname[=value]             Define a macro
    -E                               Pre-processor only
    -S                               Decompile generated code
    -I directory                     Specify include path (not yet ....)
    -o outfile                       Specify outfile
    -O level                         Specify optimization level (0,1,2)
    -v, --verbose                    Be verbose
    -V, --version                    Display version
        --[no-]declare               Require declarations
        --[no-]progress              Print progress
        --[no-]summary               Print summary
        --[no-]xref                  Print Cross References
    -h, --help                       Display help information


